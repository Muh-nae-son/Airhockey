// ----- STATES -----
#define STATE_IDLE   0
#define STATE_ACTIVE 1

// INITIALIZE BY STARTING AS IDLE
int systemState = STATE_IDLE;

// IR break-beam sensord
const int PENNY_BEAM_PIN = 17;  // LOW = broken, HIGH = unbroken
const int PLAYER1_BEAM_PIN = 19;  // LOW = broken, HIGH = unbroken
const int PLAYER2_BEAM_PIN = 18;  // LOW = broken, HIGH = unbroken

void setup() {
  // put the setup code here, youre gonna run this one time:
Serial.begin(115200);

  // Beam sensor
  pinMode(PENNY_BEAM_PIN, INPUT);
  pinMode(PLAYER1_BEAM_PIN, INPUT);
  pinMode(PLAYER2_BEAM_PIN, INPUT);
}

void loop() {
  if (systemState == STATE_IDLE) {
    // check beam condition
    Serial.println("Please Insert Penny...");
    if (digitalRead(PENNY_BEAM_PIN) == HIGH) {
      // Beam broken -> enter ACTIVE state
      Serial.println(systemState  );
      Serial.println("Penny Inserted! Starting Game");
      systemState = STATE_ACTIVE;
      Serial.println(systemState  );
      delay(5000);

      //Can also run any initialization/start of game code here. Like flashing lights or buzzers to say game is starting
      // Once you're done doing whatever you want in active state and changed the state to what you want, exit out with a return; so the code
      // can start from the beginning and pick which activity to do based on state.
      return;
    }

  }

  if (systemState == STATE_ACTIVE) {
   Serial.println("OMG you're playing the game!!!!");
   Serial.println(systemState  );
   if (digitalRead(PLAYER1_BEAM_PIN) == HIGH) {
     Serial.println("Game Over! Nice Playing! Come Play Again!");
     systemState = STATE_IDLE;
     delay(5000);

     // Stop fans with ledcWrite
     // Once you're done doing whatever you want in active state and changed the state to what you want, exit out with a return; so the code
     // can start from the beginning and pick which activity to do based on state.
     return;
    }

  }

}
